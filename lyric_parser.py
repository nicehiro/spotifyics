import re
from collections import OrderedDict


class LyricParser(object):
    """Parse Netease Mysic API lyric."""

    def __init__(self, lyric_ori, lyric_transed, has_trans=True):
        self.pattern = re.compile('\[(\d+):(\d+).(\d+)\](.*)\n')
        self.lyric_origin = lyric_ori
        self.lyric_translate = lyric_transed
        self.has_trans = has_trans

    def parse2dict(self, lyric):
        lyric_list = self.pattern.findall(lyric)
        d = OrderedDict()
        for line in lyric_list:
            mills = int(line[0]) * 60 * 1000 + int(line[1]) * 1000 + int(line[2])
            txt = line[3]
            d[mills] = txt
        return d

    def parse(self):
        lyric_ori_dict = self.parse2dict(self.lyric_origin)
        lyric_transed_dict = OrderedDict()
        if self.has_trans:
            lyric_transed_dict = self.parse2dict(self.lyric_translate)
        for key in lyric_ori_dict:
            lyric_ori_dict[key] += '\n' + lyric_transed_dict[key] + '\n' \
                if key in lyric_transed_dict else '\n'
        return lyric_ori_dict


lyric_origin = "[00:09.480]The club isn't the best place to find a lover\n[00:11.750]So the bar is where I go\n[00:14.590]Me and my friends at the table doing shots\n[00:16.760]Drinking faster and then we talk slow\n[00:19.500]You come over and start up a conversation with just me\n[00:21.820]And trust me I'll give it a chance now\n[00:24.420]Take my hand, stop, Put Van The Man on the jukebox\n[00:26.880]And then we start to dance, and now I'm singing like\n[00:29.580]\n[00:29.820]Girl, you know I want your love\n[00:31.980]Your love was handmade for somebody like me\n[00:34.970]Come on now, follow my lead\n[00:37.010]I may be crazy, don't mind me, say\n[00:39.550]Boy, let's not talk too much\n[00:42.040]Grab on my waist and put that body on me\n[00:45.100]Come on now, follow my lead\n[00:46.880]Come—come on now, follow my lead\n[00:48.740]\n[00:50.460]I'm in love with the shape of you\n[00:52.820]We push and pull like a magnet do\n[00:55.330]Although my heart is falling too\n[00:57.800]I'm in love with your body\n[01:00.360]Last night you were in my room\n[01:02.940]And now my bedsheets smell like you\n[01:05.120]Every day discovering something brand new\n[01:07.830]I'm in love with your body\n[01:09.590]Oh—i—oh—i—oh—i—oh—i\n[01:12.790]I'm in love with your body\n[01:14.460]Oh—i—oh—i—oh—i—oh—i\n[01:17.830]I'm in love with your body\n[01:19.420]Oh—i—oh—i—oh—i—oh—i\n[01:22.820]I'm in love with your body\n[01:24.980]Every day discovering something brand new\n[01:27.900]I'm in love with the shape of you\n[01:29.890]\n[01:30.070]One week in we let the story begin\n[01:31.750]We're going out on our first date\n[01:34.500]But you and me are thrifty so go all you can eat\n[01:36.730]Fill up your bag and I fill up a plate\n[01:39.250]We talk for hours and hours about the sweet and the sour\n[01:41.800]And how your family is doin' okay\n[01:44.340]And leave and get in a taxi, we kiss in the backseat\n[01:46.990]Tell the driver make the radio play, and I'm singing like\n[01:49.370]\n[01:49.610]Girl, you know I want your love\n[01:51.830]Your love was handmade for somebody like me\n[01:55.140]Come on now, follow my lead\n[01:56.980]I may be crazy, don't mind me, say\n[01:59.520]Boy, let's not talk too much\n[02:02.050]Grab on my waist and put that body on me\n[02:05.130]Come on now, follow my lead\n[02:06.850]Come—come on now, follow my lead\n[02:08.740]\n[02:10.610]I'm in love with the shape of you\n[02:12.900]We push and pull like a magnet do\n[02:15.360]Although my heart is falling too\n[02:17.970]I'm in love with your body\n[02:20.570]Last night you were in my room\n[02:22.940]And now my bedsheets smell like you\n[02:25.140]Every day discovering something brand new\n[02:28.050]I'm in love with your body\n[02:29.530]Oh—i—oh—i—oh—i—oh—i\n[02:32.930]I'm in love with your body\n[02:34.470]Oh—i—oh—i—oh—i—oh—i\n[02:37.790]I'm in love with your body\n[02:39.510]Oh—i—oh—i—oh—i—oh—i\n[02:42.880]I'm in love with your body\n[02:44.990]Every day discovering something brand new\n[02:48.200]I'm in love with the shape of you\n[02:49.950]\n[02:50.150]Come on, be my baby, come on\n[02:52.340]Come on, be my baby, come on\n[02:54.840]Come on, be my baby, come on\n[02:57.300]Come on, be my baby, come on\n[02:59.820]Come on, be my baby, come on\n[03:02.350]Come on, be my baby, come on\n[03:04.820]Come on, be my baby, come on\n[03:07.340]Come on, be my baby, come on\n[03:09.410]\n[03:10.760]I'm in love with the shape of you\n[03:12.820]We push and pull like a magnet too\n[03:15.360]Although my heart is falling too\n[03:17.960]I'm in love with your body\n[03:20.420]Last night you were in my room\n[03:22.930]And now my bedsheets smell like you\n[03:25.060]Every day discovering something brand new\n[03:27.830] I'm in love with your body\n[03:29.550]Come on, be my baby, come on\n[03:32.260]Come on, be my baby, come on\n[03:33.530]I'm in love with your body\n[03:35.110]Come on, be my baby, come on\n[03:37.190]Come on, be my baby, come on\n[03:38.280]I'm in love with your body\n[03:39.990]Come on, be my baby, come on\n[03:42.310]Come on, be my baby, come on\n[03:43.330]I'm in love with your body\n[03:44.820]Every day discovering something brand new\n[03:48.010]I'm in love with the shape of you\n[03:50.630]\n"

lyric_transed = "[by:咆哮的小清新___]\n[00:09.480]这俱乐部不是个能找到安慰的地方\n[00:11.750]所以我们去往酒吧\n[00:14.590]我和我朋友们在桌前干着杯\n[00:16.760]一饮而尽 再缓缓诉起衷肠\n[00:19.500]这时你走过来开始和我搭讪\n[00:21.820]你知道我会予以回答\n[00:24.420]牵起我手 缓缓停下 在点唱机里放起Van The Man\n[00:26.880]在歌声中我们慢慢起舞 我轻轻哼着\n[00:29.820]女孩儿 你知道我想得到你的爱\n[00:31.980]你的爱也只为像我这样的人量身存在\n[00:34.970]来吧 就跟着我\n[00:37.010]我可能会失去理智 别太在意 就开口对我说\n[00:39.550]噢男孩儿 别说太多话\n[00:42.040]就搂着我的腰 用身体靠近我\n[00:45.100]来吧 就跟着我\n[00:46.880]就现在 跟着我来\n[00:50.460]我深陷在以你名状的爱里\n[00:52.820]如磁铁相吸相斥却互不分离\n[00:55.330]我的心也已随你沦陷\n[00:57.800]你的身体亦让我无比眷恋\n[01:00.360]昨晚你在我房间过夜\n[01:02.940]今晨床单上你的香气流连\n[01:05.120]每一天都会有崭新的发现\n[01:07.830]你的身体让我深陷眷恋\n[01:09.590]Oh—i—oh—i—oh—i—oh—i\n[01:12.790]你的身体让我无比眷恋\n[01:14.460]Oh—i—oh—i—oh—i—oh—i\n[01:17.830]深陷其中 不知疲倦\n[01:19.420]Oh—i—oh—i—oh—i—oh—i\n[01:22.820]你让我深陷爱里 不知疲倦\n[01:24.980]每一天都会有崭新的发现\n[01:27.900]我深陷在以你名状的爱里面\n[01:30.070]我们的故事开始于某一周里\n[01:31.750]初次约会 外出同行\n[01:34.500]但你我都比较省钱所以直奔吃处去\n[01:36.730]吃的塞满了你的包 我亦装了整整一盘\n[01:39.250]我们围绕着吃的甜酸苦辣聊个不停\n[01:41.800]也聊到你和美温馨的家庭\n[01:44.340]乘着出租离开 在车后座动情拥吻\n[01:46.990]让司机把收音机打开 然后我轻轻哼唱着\n[01:49.610]女孩儿 你知道我想得到你的爱\n[01:51.830]你的爱也只为像我这样的人量身存在\n[01:55.140]来吧 就跟着我\n[01:56.980]我可能会失去理智 别太在意 就开口对我说\n[01:59.520]噢男孩儿 别说太多话\n[02:02.050]就搂着我的腰 用身体靠近我\n[02:05.130]来吧 就跟着我\n[02:06.850]就现在 跟着我来\n[02:10.610]我深陷在以你名状的爱里\n[02:12.900]如磁铁相吸相斥却互不分离\n[02:15.360]我的心也已随你沦陷\n[02:17.970]你的身体亦让我无比眷恋\n[02:20.570]昨晚你在我房间过夜\n[02:22.940]今晨床单上你的香气流连\n[02:25.140]每一天都会有崭新的发现\n[02:28.050]你的身体让我深陷眷恋\n[02:29.530]Oh—i—oh—i—oh—i—oh—i\n[02:32.930]你的身体让我无比眷恋\n[02:34.470]Oh—i—oh—i—oh—i—oh—i\n[02:37.790]深陷其中 不知疲倦\n[02:39.510]Oh—i—oh—i—oh—i—oh—i\n[02:42.880]你让我深陷爱里 不知疲倦\n[02:44.990]每一天都会有崭新的发现\n[02:48.200]我深陷在以你名状的爱里面\n[02:50.150]来吧 跟我一起\n[02:52.340]来吧 做我的唯一\n[02:54.840]来吧 就跟我在一起\n[02:57.300]来吧 就做我的唯一\n[02:59.820]来吧 跟我一起\n[03:02.350]来吧 做我的唯一\n[03:04.820]来吧 就跟我在一起\n[03:07.340]来吧 就做我的唯一\n[03:10.760]我深陷在以你名状的爱里\n[03:12.820]如磁铁相吸相斥却互不分离\n[03:15.360]我的心也已随你沦陷\n[03:17.960]你的身体亦让我无比眷恋\n[03:20.420]昨晚你在我房间过夜\n[03:22.930]今晨床单上你的香气流连\n[03:25.060]每一天都会有崭新的发现\n[03:27.830]你的身体让我深陷眷恋\n[03:29.550]来吧 跟我一起\n[03:32.260]来吧 做我的唯一\n[03:33.530]你让我不知疲倦的深陷爱里\n[03:35.110]来吧 就跟我在一起\n[03:37.190]来吧 就做我的唯一\n[03:38.280]我沦陷于你无比美妙的身体\n[03:39.990]来吧 就跟我一起\n[03:42.310]来吧 就做我的唯一\n[03:43.330]我沦陷于你无比美妙的身体\n[03:44.820]有你的每一天都如此崭新\n[03:48.010]我深陷在以你名状的爱里"
